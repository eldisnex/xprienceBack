'use strict';

const a = {
   results: [
      {
         fsq_id: '51d9202a498e44076324c5fc',
         categories: [
            {
               id: 10000,
               name: 'Arts and Entertainment',
               short_name: 'Arts & Entertainment',
               plural_name: 'Arts and Entertainment',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/arts_entertainment/default_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 2063,
         geocodes: { main: { latitude: -34.609089, longitude: -58.4491 } },
         link: '/v3/places/51d9202a498e44076324c5fc',
         location: { country: 'AR', cross_street: '', formatted_address: '' },
         name: 'El As de Diamante',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      },
      {
         fsq_id: '50170e5d16483759008b21ce',
         categories: [
            {
               id: 17025,
               name: 'Electronics Store',
               short_name: 'Electronics',
               plural_name: 'Electronics Stores',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/shops/technology_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'Unsure',
         distance: 4253,
         geocodes: {
            drop_off: { latitude: -34.599092, longitude: -58.420381 },
            main: { latitude: -34.599116, longitude: -58.420218 },
            roof: { latitude: -34.599116, longitude: -58.420218 }
         },
         link: '/v3/places/50170e5d16483759008b21ce',
         location: {
            address: 'Av Medrano, 925',
            country: 'AR',
            cross_street: 'Esq. Lavalle',
            formatted_address:
               'Av Medrano, 925 (Esq. Lavalle), Buenos Aires, Ciudad Autónoma de Buenos Aires',
            locality: 'Buenos Aires',
            region: 'Ciudad Autónoma de Buenos Aires'
         },
         name: 'Bs. As. Digital',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      },
      {
         fsq_id: '500ecc63e4b090c2d04ba03c',
         categories: [
            {
               id: 12047,
               name: 'Student Center',
               short_name: 'Student Center',
               plural_name: 'Student Centers',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/education/studentcenter_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 5251,
         geocodes: {
            drop_off: { latitude: -34.584427, longitude: -58.427529 },
            main: { latitude: -34.584508, longitude: -58.427472 }
         },
         link: '/v3/places/500ecc63e4b090c2d04ba03c',
         location: {
            country: 'AR',
            cross_street: '',
            formatted_address: 'Ciudad Autónoma de Buenos Aires',
            region: 'Ciudad Autónoma de Buenos Aires'
         },
         name: 'Asdra',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      },
      {
         fsq_id: '5c6d9143396de0002c7141a6',
         categories: [
            {
               id: 17082,
               name: 'Furniture and Home Store',
               short_name: 'Furniture and Home Store',
               plural_name: 'Furniture and Home Stores',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/shops/furniture_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 6656,
         geocodes: { main: { latitude: -34.579288, longitude: -58.40847 } },
         link: '/v3/places/5c6d9143396de0002c7141a6',
         location: {
            address: 'Segui 3578',
            country: 'AR',
            cross_street: 'Salguero',
            formatted_address: 'Segui 3578 (Salguero), 1425, Buenos Aires C.F.',
            locality: 'Palermo',
            postcode: '1425',
            region: 'Buenos Aires C.F.'
         },
         name: 'Matiz Bs As DECO',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      },
      {
         fsq_id: '4f33fa5c4fc6bf7ff9b48b17',
         categories: [
            {
               id: 17082,
               name: 'Furniture and Home Store',
               short_name: 'Furniture and Home Store',
               plural_name: 'Furniture and Home Stores',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/shops/furniture_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 7084,
         geocodes: {
            drop_off: { latitude: -34.585534, longitude: -58.393298 },
            main: { latitude: -34.585419, longitude: -58.393357 }
         },
         link: '/v3/places/4f33fa5c4fc6bf7ff9b48b17',
         location: {
            address: 'Av. Pueyrredon 2501',
            country: 'AR',
            formatted_address: 'Av. Pueyrredon 2501, Buenos Aires C.F.',
            locality: 'Recoleta',
            region: 'Buenos Aires C.F.'
         },
         name: 'Barugel Azulay - Bs. As. Design',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      },
      {
         fsq_id: '5081a0e7e4b08785e830f914',
         categories: [
            {
               id: 11128,
               name: 'Coworking Space',
               short_name: 'Coworking Space',
               plural_name: 'Coworking Spaces',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/building/office_coworkingspace_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'Unsure',
         distance: 7123,
         geocodes: {
            drop_off: { latitude: -34.603426, longitude: -58.3795 },
            main: { latitude: -34.60343, longitude: -58.379566 },
            roof: { latitude: -34.60343, longitude: -58.379566 }
         },
         link: '/v3/places/5081a0e7e4b08785e830f914',
         location: {
            address: 'Suipacha 429',
            country: 'AR',
            cross_street: 'Avenida Corrientes',
            formatted_address:
               'Suipacha 429 (Avenida Corrientes), Buenos Aires, Buenos Aires C.F.',
            locality: 'Buenos Aires',
            region: 'Buenos Aires C.F.'
         },
         name: 'AS Data Center',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      },
      {
         fsq_id: '5b640cd3ff0306002c870883',
         categories: [
            {
               id: 11010,
               name: 'Automotive Repair Shop',
               short_name: 'Auto Repair',
               plural_name: 'Automotive Repair Shops',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/shops/automotive_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 7496,
         geocodes: {
            main: { latitude: -34.699635, longitude: -58.411601 },
            roof: { latitude: -34.699635, longitude: -58.411601 }
         },
         link: '/v3/places/5b640cd3ff0306002c870883',
         location: {
            address: 'Av Rivadavia 1644',
            country: 'AR',
            cross_street: '',
            formatted_address: 'Av Rivadavia 1644, 1824 Lanús, Buenos Aires',
            locality: 'Lanús',
            postcode: '1824',
            region: 'Buenos Aires'
         },
         name: 'Asd Auto Radio',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      },
      {
         fsq_id: '5a7f76e911f1488e2671f080',
         categories: [],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 1355,
         geocodes: { main: { latitude: -34.637462, longitude: -58.460218 } },
         link: '/v3/places/5a7f76e911f1488e2671f080',
         location: {
            country: 'AR',
            formatted_address: '1406, Ciudad Autónoma de Buenos Aires',
            postcode: '1406',
            region: 'Ciudad Autónoma de Buenos Aires'
         },
         name: 'Destapaciones - la Bs As Desobstrucciones',
         related_places: {}
      },
      {
         fsq_id: 'faebf6ac71e4420b9d75eef7',
         categories: [
            {
               id: 17011,
               name: 'Car Parts and Accessories',
               short_name: 'Car Part and Accessory',
               plural_name: 'Car Parts and Accessories',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/shops/automotive_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 4748,
         geocodes: {
            drop_off: { latitude: -34.618277, longitude: -58.401024 },
            main: { latitude: -34.618267, longitude: -58.400901 },
            roof: { latitude: -34.618267, longitude: -58.400901 }
         },
         link: '/v3/places/faebf6ac71e4420b9d75eef7',
         location: {
            address: 'Alberti 744',
            country: 'AR',
            formatted_address:
               'Alberti 744, 1223 Buenos Aires, Ciudad Autónoma de Buenos Aires',
            locality: 'Buenos Aires',
            postcode: '1223',
            region: 'Ciudad Autónoma de Buenos Aires'
         },
         name: 'El As del Tablero',
         related_places: {}
      },
      {
         fsq_id: '5074b13de4b00922913b2176',
         categories: [
            {
               id: 15007,
               name: 'Dentist',
               short_name: 'Dentist',
               plural_name: 'Dentists',
               icon: {
                  prefix:
                     'https://ss3.4sqi.net/img/categories_v2/building/medical_dentist_',
                  suffix: '.png'
               }
            }
         ],
         chains: [],
         closed_bucket: 'LikelyOpen',
         distance: 13376,
         geocodes: {
            drop_off: { latitude: -34.607397, longitude: -58.595711 },
            main: { latitude: -34.607395, longitude: -58.595848 }
         },
         link: '/v3/places/5074b13de4b00922913b2176',
         location: {
            address: 'Gral Victoria 393',
            country: 'AR',
            cross_street: '',
            formatted_address:
               'Gral Victoria 393, 1684 El Palomar, Buenos Aires',
            locality: 'El Palomar',
            postcode: '1684',
            region: 'Buenos Aires'
         },
         name: 'AS Dental',
         related_places: {},
         timezone: 'America/Argentina/Buenos_Aires'
      }
   ],
   context: {
      geo_bounds: {
         circle: {
            center: { latitude: -34.6275438, longitude: -58.4515931 },
            radius: 22000
         }
      }
   }
};

$('form').submit((e) => onSent(e));

const options = {};

navigator.geolocation.getCurrentPosition((position) => {
   options.latitude = position.coords.latitude;
   options.longitude = position.coords.longitude;
});

const onSent = (e) => {
   e.preventDefault();
   console.log(e.target);
   let formdata = new FormData(e.target);
   console.log(formdata);
   let data = {};
   [...formdata.keys()].forEach((key) => {
      let values = formdata.getAll(key);
      data[key] = values.length > 1 ? values : values.join();
   });
   options.query = data.query;
   $.post(handleCreateUrl, options)
      .then((res) => JSON.parse(res).results)
      .then((res) => {
         res.forEach((item) => {
            createCard(item);
         });
      });
};

const createCard = (item) => {
   const template = document.getElementById('subCardTemplate').content;
   const clone = document.importNode(template, true);
   $.post(handleImage, { id: item.fsq_id })
      .then((res) => JSON.parse(res))
      .then((res) => (item.img = res[0].prefix + 'original' + res[0].suffix))
      .then(() => {
         clone.querySelector('img').src = item.img;
         clone.querySelector('.coverImage').textContent = item.name;
         clone.querySelector('h3').textContent = item.name;
         clone.querySelector('.desc').textContent = item.categories[0].name;
         clone.querySelector('.stars').textContent = '4.5';
         clone.querySelector('.people').textContent = 'For 2 people';
         $('.cardContainerFlex').append(clone);
      });
};

createCard();
